import{a as B,t as W,c as xe}from"../chunks/Ce9dqvW3.js";import{h as z,d as Te,b as Ee,E as S,aa as Se,ab as le,ac as ne,ad as K,x as V,ak as He,ar as X,u as ge,j as me,v as Ie,ao as he,_ as oe,g as Me,as as Ne,an as Ae,at as Ce,au as Re,X as De,a8 as Oe,a2 as Be,m as ze,k as ie,av as Je,aw as Ye,ax as $e,ai as Le,p as Ue,I as Q,z as Ve,t as Z,a as We,K as C,c as y,s as I,f as ce,r as x,J as qe,ay as Fe}from"../chunks/Ch4HhSdZ.js";import{d as Pe,s as j}from"../chunks/BmlV4D2q.js";import{p as ee,i as ve}from"../chunks/BS501eKZ.js";import{U as Xe,r as Ge,g as Ke,s as Qe,b as q,t as F,d as ue,c as fe}from"../chunks/dahw8YVr.js";import{b as Ze}from"../chunks/EBAiWnVy.js";import{b as P}from"../chunks/MfDRg49V.js";import{o as je}from"../chunks/Cd1vMRAD.js";import{g as ea}from"../chunks/BymYVIbb.js";function aa(i,e){return e}function ta(i,e,s,o){for(var r=[],u=e.length,c=0;c<u;c++)Ne(e[c].e,r,!0);var w=u>0&&r.length===0&&s!==null;if(w){var f=s.parentNode;Ae(f),f.append(s),o.clear(),M(i,e[0].prev,e[u-1].next)}Ce(r,()=>{for(var m=0;m<u;m++){var p=e[m];w||(o.delete(p.k),M(i,p.prev,p.next)),Re(p.e,!w)}})}function sa(i,e,s,o,r,u=null){var c=i,w={flags:e,items:new Map,first:null};z&&Te();var f=null,m=!1,p=De(()=>{var t=s();return Oe(t)?t:t==null?[]:he(t)});Ee(()=>{var t=S(p),d=t.length;if(m&&d===0)return;m=d===0;let l=!1;if(z){var n=c.data===Se;n!==(d===0)&&(c=le(),ne(c),K(!1),l=!0)}if(z){for(var h=null,b,_=0;_<d;_++){if(V.nodeType===8&&V.data===He){c=V,l=!0,K(!1);break}var v=t[_],k=o(v,_);b=_e(V,w,h,null,v,k,_,r,e),w.items.set(k,b),h=b}d>0&&ne(le())}if(!z){var J=Be;ra(t,w,c,r,e,(J.f&X)!==0,o)}u!==null&&(d===0?f?ge(f):f=me(()=>u(c)):f!==null&&Ie(f,()=>{f=null})),l&&K(!0),S(p)}),z&&(c=V)}function ra(i,e,s,o,r,u,c,w){var f=i.length,m=e.items,p=e.first,t=p,d,l=null,n=[],h=[],b,_,v,k;for(k=0;k<f;k+=1){if(b=i[k],_=c(b,k),v=m.get(_),v===void 0){var J=t?t.e.nodes_start:s;l=_e(J,e,l,l===null?e.first:l.next,b,_,k,o,r),m.set(_,l),n=[],h=[],t=l.next;continue}if(la(v,b,k),v.e.f&X&&ge(v.e),v!==t){if(d!==void 0&&d.has(v)){if(n.length<h.length){var H=h[0],T;l=H.prev;var N=n[0],Y=n[n.length-1];for(T=0;T<n.length;T+=1)de(n[T],H,s);for(T=0;T<h.length;T+=1)d.delete(h[T]);M(e,N.prev,Y.next),M(e,l,N),M(e,Y,H),t=H,l=Y,k-=1,n=[],h=[]}else d.delete(v),de(v,t,s),M(e,v.prev,v.next),M(e,v,l===null?e.first:l.next),M(e,l,v),l=v;continue}for(n=[],h=[];t!==null&&t.k!==_;)(u||!(t.e.f&X))&&(d??(d=new Set)).add(t),h.push(t),t=t.next;if(t===null)continue;v=t}n.push(v),l=v,t=v.next}if(t!==null||d!==void 0){for(var a=d===void 0?[]:he(d);t!==null;)(u||!(t.e.f&X))&&a.push(t),t=t.next;var g=a.length;if(g>0){var $=null;ta(e,a,$,m)}}oe.first=e.first&&e.first.e,oe.last=l&&l.e}function la(i,e,s,o){Me(i.v,e),i.i=s}function _e(i,e,s,o,r,u,c,w,f,m){var p=(f&Ye)!==0,t=(f&$e)===0,d=p?t?ze(r):ie(r):r,l=f&Je?ie(c):c,n={i:l,v:d,k:u,a:null,e:null,prev:s,next:o};try{return n.e=me(()=>w(i,d,l),z),n.e.prev=s&&s.e,n.e.next=o&&o.e,s===null?e.first=n:(s.next=n,s.e.next=n.e),o!==null&&(o.prev=n,o.e.prev=n.e),n}finally{}}function de(i,e,s){for(var o=i.next?i.next.e.nodes_start:s,r=e?e.e.nodes_start:s,u=i.e.nodes_start;u!==o;){var c=Le(u);r.before(u),u=c}}function M(i,e,s){e===null?i.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}const ka=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var na=W('<h3 class="center-align middle svelte-w4lw6k">No messages yet...</h3>'),oa=W('<article class="message bottom-round left-round border self svelte-w4lw6k"><div class="column" style="border-radius: 0"><div class="row self svelte-w4lw6k"><h5 class="right-align svelte-w4lw6k">You</h5> <img class="circle right right-align  large svelte-w4lw6k"></div> <p class="message-text"> </p></div></article>'),ia=W('<article class="message bottom-round right-round secondary-container svelte-w4lw6k"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text"> </p></div></article>'),ca=W(`<p id="top-line-text" class="center-align svelte-w4lw6k">You've reached the start of the chat</p> <p id="top-line" class="svelte-w4lw6k">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),va=(i,e)=>{i.key==="Enter"&&e()},ua=W('<main class="responsive fixed center middle svelte-w4lw6k"><div id="chatbox" class="bottom-padding svelte-w4lw6k"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav id="message-nav" class="center-align bottom-align svelte-w4lw6k" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="field label suffix border round fill large bottom fill" style="width:70%"><input type="text"> <label>Message</label></div> <button class="square round small-elevate extra primary right"><i>send</i></button></nav></main>');function ya(i,e){Ue(e,!0);let s,o=Q(ee([])),r,u,c=Q(""),w,f,m=Q(!1);function p(){f=new WebSocket(`wss://${window.location.host}/ws`),f.onopen=()=>{console.log("Connected to the WebSocket server")},f.onmessage=a=>{const g=JSON.parse(a.data);console.log("sSReceived message: ",g),C(o,ee([...S(o),g]))},f.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{p()},500)}}function t(){return fetch("/messages",{method:"GET"}).then(g=>{if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}).catch(g=>{throw console.error("Failed to load messages:",g),g})}function d(){let a=window.innerHeight-parseFloat(window.getComputedStyle(u).height)-50;r.style.height=a+"px"}async function l(){console.log("Sending message");const a=new Xe;if(!await a.validateLogin()){ea("/signup");return}const g=S(c);console.log("user_id: ",a.apikey,"username:",a.username);const $={username:a.username,message:g,user_id:a.apikey};f.send(JSON.stringify($)),C(c,"")}function n(){r.scrollTop=r.scrollHeight,console.log("Scrolled to bottom"),C(m,!1)}Ve(()=>{S(o),r&&r.offsetHeight+r.scrollTop>r.scrollHeight-50&&Fe().then(()=>{r.scrollTo(0,r.scrollHeight)})}),je(()=>{p(),setTimeout(()=>{n()},100),t().then(a=>{C(o,ee(a))}).catch(a=>{console.error("Error loading messages:",a)}),window.onresize=function(){d()},r.onload=n,r.onscroll=()=>{r.scrollTop+r.offsetHeight<r.scrollHeight-r.offsetHeight?C(m,!0):C(m,!1)}});var h=ua(),b=y(h),_=y(b);_.__click=n;var v=I(_,2);{var k=a=>{var g=na();B(a,g)},J=a=>{var g=ca(),$=I(ce(g),4);sa($,17,()=>S(o),aa,(pe,ae)=>{let R=()=>S(ae).username,te=()=>S(ae).message;var se=xe(),we=ce(se);{var be=D=>{var E=oa(),L=y(E),A=y(L),O=I(y(A),2);x(A);var U=I(A,2),G=y(U,!0);x(U),x(L),x(E),Z(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),j(G,te())}),F(5,E,()=>ue),F(6,E,()=>fe),B(D,E)},ke=D=>{var E=ia(),L=y(E),A=y(L),O=y(A),U=I(O,2),G=y(U,!0);x(U),x(A);var re=I(A,2),ye=y(re,!0);x(re),x(L),x(E),Z(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),j(G,R()),j(ye,te())}),F(5,E,()=>ue,()=>({axis:"x"})),F(6,E,()=>fe),B(D,E)};ve(we,D=>{R()===Ke("username")?D(be):D(ke,!1)})}B(pe,se)}),B(a,g)};ve(v,a=>{S(o).length===0?a(k):a(J,!1)})}x(b),P(b,a=>r=a,()=>r);var H=I(b,2),T=y(H),N=y(T);Ge(N),N.__keydown=[va,l],P(N,a=>w=a,()=>w),qe(2),x(T);var Y=I(T,2);Y.__click=l,x(H),P(H,a=>u=a,()=>u),x(h),P(h,a=>s=a,()=>s),Z(()=>Qe(_,`scrollToBottom l m top fixed right round chip small-elevate tertiary-container ${(S(m)?"active":"")??""} svelte-w4lw6k`)),Ze(N,()=>S(c),a=>C(c,a)),B(i,h),We()}Pe(["click","keydown"]);export{ya as component,ka as universal};
