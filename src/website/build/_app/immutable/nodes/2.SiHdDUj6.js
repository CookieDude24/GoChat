import{a as B,t as W,c as xe}from"../chunks/Ce9dqvW3.js";import{h as z,d as ke,b as Te,E,aa as Ee,ab as re,ac as le,ad as G,x as V,ak as Se,ar as P,u as de,j as he,v as He,ao as ge,_ as ne,g as Ie,as as Me,an as Ne,at as Ae,au as Ce,X as Re,a8 as De,a2 as Oe,m as Be,k as oe,av as ze,aw as Je,ax as Ye,ai as $e,p as Le,I as K,z as Ue,t as Q,a as Ve,K as C,c as x,s as I,f as ie,r as k,J as We,ay as qe}from"../chunks/Ch4HhSdZ.js";import{d as Fe,s as Z}from"../chunks/BmlV4D2q.js";import{p as j,i as ce}from"../chunks/BS501eKZ.js";import{U as Pe,r as Xe,g as Ge,s as Ke,b as q,t as ve,c as ue}from"../chunks/CXv6ZHf4.js";import{b as Qe}from"../chunks/B_k9T6Re.js";import{b as F}from"../chunks/MfDRg49V.js";import{o as Ze}from"../chunks/Cd1vMRAD.js";import{g as je}from"../chunks/BpHN9GMK.js";function ea(i,e){return e}function aa(i,e,s,o){for(var r=[],u=e.length,c=0;c<u;c++)Me(e[c].e,r,!0);var b=u>0&&r.length===0&&s!==null;if(b){var f=s.parentNode;Ne(f),f.append(s),o.clear(),M(i,e[0].prev,e[u-1].next)}Ae(r,()=>{for(var g=0;g<u;g++){var _=e[g];b||(o.delete(_.k),M(i,_.prev,_.next)),Ce(_.e,!b)}})}function ta(i,e,s,o,r,u=null){var c=i,b={flags:e,items:new Map,first:null};z&&ke();var f=null,g=!1,_=Re(()=>{var t=s();return De(t)?t:t==null?[]:ge(t)});Te(()=>{var t=E(_),d=t.length;if(g&&d===0)return;g=d===0;let l=!1;if(z){var n=c.data===Ee;n!==(d===0)&&(c=re(),le(c),G(!1),l=!0)}if(z){for(var p=null,w,m=0;m<d;m++){if(V.nodeType===8&&V.data===Se){c=V,l=!0,G(!1);break}var v=t[m],y=o(v,m);w=pe(V,b,p,null,v,y,m,r,e),b.items.set(y,w),p=w}d>0&&le(re())}if(!z){var J=Oe;sa(t,b,c,r,e,(J.f&P)!==0,o)}u!==null&&(d===0?f?de(f):f=he(()=>u(c)):f!==null&&He(f,()=>{f=null})),l&&G(!0),E(_)}),z&&(c=V)}function sa(i,e,s,o,r,u,c,b){var f=i.length,g=e.items,_=e.first,t=_,d,l=null,n=[],p=[],w,m,v,y;for(y=0;y<f;y+=1){if(w=i[y],m=c(w,y),v=g.get(m),v===void 0){var J=t?t.e.nodes_start:s;l=pe(J,e,l,l===null?e.first:l.next,w,m,y,o,r),g.set(m,l),n=[],p=[],t=l.next;continue}if(ra(v,w,y),v.e.f&P&&de(v.e),v!==t){if(d!==void 0&&d.has(v)){if(n.length<p.length){var H=p[0],T;l=H.prev;var N=n[0],Y=n[n.length-1];for(T=0;T<n.length;T+=1)fe(n[T],H,s);for(T=0;T<p.length;T+=1)d.delete(p[T]);M(e,N.prev,Y.next),M(e,l,N),M(e,Y,H),t=H,l=Y,y-=1,n=[],p=[]}else d.delete(v),fe(v,t,s),M(e,v.prev,v.next),M(e,v,l===null?e.first:l.next),M(e,l,v),l=v;continue}for(n=[],p=[];t!==null&&t.k!==m;)(u||!(t.e.f&P))&&(d??(d=new Set)).add(t),p.push(t),t=t.next;if(t===null)continue;v=t}n.push(v),l=v,t=v.next}if(t!==null||d!==void 0){for(var a=d===void 0?[]:ge(d);t!==null;)(u||!(t.e.f&P))&&a.push(t),t=t.next;var h=a.length;if(h>0){var $=null;aa(e,a,$,g)}}ne.first=e.first&&e.first.e,ne.last=l&&l.e}function ra(i,e,s,o){Ie(i.v,e),i.i=s}function pe(i,e,s,o,r,u,c,b,f,g){var _=(f&Je)!==0,t=(f&Ye)===0,d=_?t?Be(r):oe(r):r,l=f&ze?oe(c):c,n={i:l,v:d,k:u,a:null,e:null,prev:s,next:o};try{return n.e=he(()=>b(i,d,l),z),n.e.prev=s&&s.e,n.e.next=o&&o.e,s===null?e.first=n:(s.next=n,s.e.next=n.e),o!==null&&(o.prev=n,o.e.prev=n.e),n}finally{}}function fe(i,e,s){for(var o=i.next?i.next.e.nodes_start:s,r=e?e.e.nodes_start:s,u=i.e.nodes_start;u!==o;){var c=$e(u);r.before(u),u=c}}function M(i,e,s){e===null?i.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}const wa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var la=W('<h3 class="center-align middle svelte-hbh5pw">No messages yet...</h3>'),na=W('<article class="message bottom-round left-round border self svelte-hbh5pw"><div class="column" style="border-radius: 0"><div class="row self svelte-hbh5pw"><h5 class="right-align svelte-hbh5pw">You</h5> <img class="circle right right-align  large svelte-hbh5pw"></div> <p class="message-text"> </p></div></article>'),oa=W('<article class="message bottom-round right-round secondary-container svelte-hbh5pw"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text"> </p></div></article>'),ia=W(`<p id="top-line-text" class="center-align svelte-hbh5pw">You've reached the start of the chat</p> <p id="top-line" class="svelte-hbh5pw">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),ca=(i,e)=>{i.key==="Enter"&&e()},va=W('<main class="responsive fixed center middle svelte-hbh5pw"><div id="chatbox" class="bottom-padding svelte-hbh5pw"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav id="message-nav" class="center-align bottom-align svelte-hbh5pw" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="field label suffix border round fill large bottom fill" style="width:70%"><input type="text"> <label>Message</label></div> <button class="square round small-elevate extra primary right"><i>send</i></button></nav></main>');function ya(i,e){Le(e,!0);let s,o=K(j([])),r,u,c=K(""),b,f,g=K(!1);function _(){f=new WebSocket(`wss://${window.location.host}/ws`),f.onopen=()=>{console.log("Connected to the WebSocket server")},f.onmessage=a=>{const h=JSON.parse(a.data);console.log("sSReceived message: ",h),C(o,j([...E(o),h]))},f.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{_()},500)}}function t(){return fetch("/messages",{method:"GET"}).then(h=>{if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);return h.json()}).catch(h=>{throw console.error("Failed to load messages:",h),h})}function d(){let a=window.innerHeight-parseFloat(window.getComputedStyle(u).height)-50;r.style.height=a+"px"}async function l(){console.log("Sending message");const a=new Pe;if(!await a.validateLogin()){je("/signup");return}const h=E(c);console.log("user_id: ",a.apikey,"username:",a.username);const $={username:a.username,message:h,user_id:a.apikey};f.send(JSON.stringify($)),C(c,"")}function n(){r.scrollTop=r.scrollHeight,console.log("Scrolled to bottom"),C(g,!1)}Ue(()=>{E(o),r&&r.offsetHeight+r.scrollTop>r.scrollHeight-50&&qe().then(()=>{r.scrollTo(0,r.scrollHeight)})}),Ze(()=>{_(),setTimeout(()=>{n()},100),t().then(a=>{C(o,j(a))}).catch(a=>{console.error("Error loading messages:",a)}),window.onresize=function(){d()},r.onload=n,r.onscroll=()=>{r.scrollTop+r.offsetHeight<r.scrollHeight-r.offsetHeight?C(g,!0):C(g,!1)}});var p=va(),w=x(p),m=x(w);m.__click=n;var v=I(m,2);{var y=a=>{var h=la();B(a,h)},J=a=>{var h=ia(),$=I(ie(h),4);ta($,17,()=>E(o),ea,(me,ee)=>{let R=()=>E(ee).username,ae=()=>E(ee).message;var te=xe(),_e=ie(te);{var be=D=>{var S=na(),L=x(S),A=x(L),O=I(x(A),2);k(A);var U=I(A,2),X=x(U,!0);k(U),k(L),k(S),Q(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),Z(X,ae())}),ve(7,S,()=>ue),B(D,S)},we=D=>{var S=oa(),L=x(S),A=x(L),O=x(A),U=I(O,2),X=x(U,!0);k(U),k(A);var se=I(A,2),ye=x(se,!0);k(se),k(L),k(S),Q(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),Z(X,R()),Z(ye,ae())}),ve(7,S,()=>ue,()=>({axis:"x"})),B(D,S)};ce(_e,D=>{R()===Ge("username")?D(be):D(we,!1)})}B(me,te)}),B(a,h)};ce(v,a=>{E(o).length===0?a(y):a(J,!1)})}k(w),F(w,a=>r=a,()=>r);var H=I(w,2),T=x(H),N=x(T);Xe(N),N.__keydown=[ca,l],F(N,a=>b=a,()=>b),We(2),k(T);var Y=I(T,2);Y.__click=l,k(H),F(H,a=>u=a,()=>u),k(p),F(p,a=>s=a,()=>s),Q(()=>Ke(m,`scrollToBottom top fixed right round chip small-elevate tertiary-container ${(E(g)?"active":"")??""} svelte-hbh5pw`)),Qe(N,()=>E(c),a=>C(c,a)),B(i,p),Ve()}Fe(["click","keydown"]);export{ya as component,wa as universal};
