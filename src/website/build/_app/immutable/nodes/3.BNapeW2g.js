import{a as S,t as I,c as ye}from"../chunks/ekuua-q1.js";import{n as L,o as Ze,m as je,i as _,M as ea,N as xe,O as Te,P as ie,G as V,an as aa,ay as j,D as Ne,w as Ae,E as ta,ar as De,Y as Ee,v as ra,az as oa,aq as sa,aA as la,av as na,af as ia,$ as ca,a0 as va,z as da,y as Ce,aB as ua,aC as fa,aD as ma,al as _a,p as Re,b as de,t as G,a as Oe,c as f,s as b,J as P,I as z,f as K,r as m,K as ue,u as ga,aE as ha}from"../chunks/OeBgpfWH.js";import{d as Be,s as X}from"../chunks/B2dZsSmx.js";import{i as ce}from"../chunks/tno_urru.js";import{r as fe,s as Q}from"../chunks/Ckmd1NMn.js";import{b as Pe,s as Ye,U as pa,g as ba,t as Z,c as ze,a as Se}from"../chunks/zbrIkN8n.js";import{b as me}from"../chunks/Bh7X7d1Y.js";import{p as F}from"../chunks/CQ_fv8ng.js";import{b as ve}from"../chunks/BHSylV5-.js";import{o as wa}from"../chunks/B4VyiVCG.js";import{g as ka}from"../chunks/xDksRHV0.js";import{a as ya}from"../chunks/Cay-WHhk.js";import{p as He}from"../chunks/Cw1NRKZg.js";function $e(l,e){return e}function xa(l,e,a,t){for(var g=[],c=e.length,d=0;d<c;d++)oa(e[d].e,g,!0);var y=c>0&&g.length===0&&a!==null;if(y){var u=a.parentNode;sa(u),u.append(a),t.clear(),O(l,e[0].prev,e[c-1].next)}la(g,()=>{for(var w=0;w<c;w++){var T=e[w];y||(t.delete(T.k),O(l,T.prev,T.next)),na(T.e,!y)}})}function Je(l,e,a,t,g,c=null){var d=l,y={flags:e,items:new Map,first:null};L&&Ze();var u=null,w=!1,T=ia(()=>{var r=a();return ca(r)?r:r==null?[]:De(r)});je(()=>{var r=_(T),h=r.length;if(w&&h===0)return;w=h===0;let i=!1;if(L){var s=d.data===ea;s!==(h===0)&&(d=xe(),Te(d),ie(!1),i=!0)}if(L){for(var v=null,x,p=0;p<h;p++){if(V.nodeType===8&&V.data===aa){d=V,i=!0,ie(!1);break}var n=r[p],k=t(n,p);x=Le(V,y,v,null,n,k,p,g,e),y.items.set(k,x),v=x}h>0&&Te(xe())}if(!L){var N=va;Ta(r,y,d,g,e,(N.f&j)!==0,t)}c!==null&&(h===0?u?Ne(u):u=Ae(()=>c(d)):u!==null&&ta(u,()=>{u=null})),i&&ie(!0),_(T)}),L&&(d=V)}function Ta(l,e,a,t,g,c,d,y){var u=l.length,w=e.items,T=e.first,r=T,h,i=null,s=[],v=[],x,p,n,k;for(k=0;k<u;k+=1){if(x=l[k],p=d(x,k),n=w.get(p),n===void 0){var N=r?r.e.nodes_start:a;i=Le(N,e,i,i===null?e.first:i.next,x,p,k,t,g),w.set(p,i),s=[],v=[],r=i.next;continue}if(Ea(n,x,k),n.e.f&j&&Ne(n.e),n!==r){if(h!==void 0&&h.has(n)){if(s.length<v.length){var A=v[0],C;i=A.prev;var M=s[0],D=s[s.length-1];for(C=0;C<s.length;C+=1)Me(s[C],A,a);for(C=0;C<v.length;C+=1)h.delete(v[C]);O(e,M.prev,D.next),O(e,i,M),O(e,D,A),r=A,i=D,k-=1,s=[],v=[]}else h.delete(n),Me(n,r,a),O(e,n.prev,n.next),O(e,n,i===null?e.first:i.next),O(e,i,n),i=n;continue}for(s=[],v=[];r!==null&&r.k!==p;)(c||!(r.e.f&j))&&(h??(h=new Set)).add(r),v.push(r),r=r.next;if(r===null)continue;n=r}s.push(n),i=n,r=n.next}if(r!==null||h!==void 0){for(var R=h===void 0?[]:De(h);r!==null;)(c||!(r.e.f&j))&&R.push(r),r=r.next;var U=R.length;if(U>0){var ee=null;xa(e,R,ee,w)}}Ee.first=e.first&&e.first.e,Ee.last=i&&i.e}function Ea(l,e,a,t){ra(l.v,e),l.i=a}function Le(l,e,a,t,g,c,d,y,u,w){var T=(u&fa)!==0,r=(u&ma)===0,h=T?r?da(g):Ce(g):g,i=u&ua?Ce(d):d,s={i,v:h,k:c,a:null,e:null,prev:a,next:t};try{return s.e=Ae(()=>y(l,h,i),L),s.e.prev=a&&a.e,s.e.next=t&&t.e,a===null?e.first=s:(a.next=s,a.e.next=s.e),t!==null&&(t.prev=s,t.e.prev=s.e),s}finally{}}function Me(l,e,a){for(var t=l.next?l.next.e.nodes_start:a,g=e?e.e.nodes_start:a,c=l.e.nodes_start;c!==t;){var d=_a(c);g.before(c),c=d}}function O(l,e,a){e===null?l.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}const at=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Ca=(l,e,a,t)=>{e(_(a)),t(!1)},za=I('<a class="row padding wave surface-container"><i>forum</i> <div class="max"><h6 class="small"> </h6></div></a>'),Sa=(l,e)=>{l.key==="Enter"&&e()},Ha=I('<article class="center-align center"><!> <div class="field label prefix fill round large"><i>create</i> <input type="text" maxlength="20"> <label>Create Chatroom</label></div></article>'),Ma=I("<h3>Error loading chatrooms</h3> <p> </p>",1),Ia=I("<h3>Loading ...</h3>"),Na=(l,e)=>{e(!1)},Aa=I('<dialog><div style="width: min(80vh,80vw)" class="center middle"><h5>Choose or create a new Chatroom</h5> <!> <nav class="right-align"><button class="border">Cancel</button> <button class="primary">Confirm</button></nav></div></dialog>');function Da(l,e){Re(e,!0);let a=He(e,"active",15),t=He(e,"selectedChatroom",15),g=P(void 0),c=P("");de(()=>{a()&&z(g,F(d()))});function d(){let s=Pe+"/chatrooms";return fetch(s,{method:"GET"}).then(v=>{if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return v.json()}).catch(v=>{throw console.error("Failed to load chatrooms:",v),v})}function y(){console.log("creating chatroom: ",_(c)),t(_(c)),a(!1)}var u=Aa(),w=f(u),T=b(f(w),2);ya(T,()=>_(g),s=>{var v=Ia();S(s,v)},(s,v)=>{var x=Ha(),p=f(x);Je(p,17,()=>_(v),$e,(N,A)=>{var C=za();C.__click=[Ca,t,A,a];var M=b(f(C),2),D=f(M),R=f(D,!0);m(D),m(M),m(C),G(()=>X(R,_(A))),S(N,C)});var n=b(p,2),k=b(f(n),2);fe(k),k.__keydown=[Sa,y],ue(2),m(n),m(x),me(k,()=>_(c),N=>z(c,N)),S(s,x)},(s,v)=>{var x=Ma(),p=b(K(x),2),n=f(p,!0);m(p),G(()=>X(n,_(v))),S(s,x)});var r=b(T,2),h=f(r);h.__click=[Na,a];var i=b(h,2);i.__click=y,m(r),m(w),m(u),G(()=>Ye(u,`max ${(a()?"active":"inactive")??""} center-align`)),S(l,u),Oe()}Be(["click","keydown"]);function Ie(l,e){z(e,!_(e))}var Ra=I('<h3 class="center-align middle svelte-1k9mdz7">No messages yet...</h3>'),Oa=I('<article class="message bottom-round left-round border self svelte-1k9mdz7"><div class="column" style="border-radius: 0"><div class="row self svelte-1k9mdz7"><h5 class="right-align svelte-1k9mdz7">You</h5> <img class="circle right right-align  large svelte-1k9mdz7"></div> <p class="message-text svelte-1k9mdz7"> </p></div></article>'),Ba=I('<article class="message bottom-round right-round secondary-container svelte-1k9mdz7"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text svelte-1k9mdz7"> </p></div></article>'),Pa=I(`<p id="top-line-text" class="center-align svelte-1k9mdz7">You've reached the start of the chat</p> <p id="top-line" class="svelte-1k9mdz7">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),Ya=(l,e)=>{l.key==="Enter"&&e()},$a=(l,e)=>{l.key==="Enter"&&e()},Ja=I('<!> <main class="responsive fixed center middle svelte-1k9mdz7"><div id="chatbox" class="bottom-padding svelte-1k9mdz7"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav class="center-align bottom-align message-nav l padding svelte-1k9mdz7" style="padding-bottom: min(1vh,3vw); flex-grow: 1; overflow: visible"><button class="round extra tertiary left"><i>sync_alt</i> <label>change chatroom</label></button> <div class="field label suffix border round fill large bottom fill" style="width:65%"><input type="text"> <label>Message</label></div> <button class="round extra primary" style="overflow: visible"><i>send</i></button></nav> <nav class="center-align bottom-align message-nav s m svelte-1k9mdz7" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="column"><button class="round extra tertiary left"><i>sync_alt</i> <label>change chatroom</label></button> <div class="row max center-align padding" style="overflow: visible; z-index: 100; width: 100vw"><div class="field label suffix border round fill large bottom fill" style="width:60%"><input type="text"> <label>Message</label></div> <button class="round extra primary"><i>send</i></button></div></div></nav></main>',1);function tt(l,e){Re(e,!0);let a=P(F([])),t,g,c=P(""),d,y=P(!1),u=P("default"),w=P(!1);function T(){d=new WebSocket(`wss://${window.location.host}/ws`),d.onopen=()=>{console.log("Connected to the WebSocket server")},d.onmessage=o=>{const E=JSON.parse(o.data);console.log("Received message: ",E),z(a,F([..._(a),E])),setTimeout(()=>{s()},500)},d.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{T()},500)}}async function r(){let o=Pe+"/messages";return fetch(o,{method:"GET"}).then(E=>{if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);return E.json()}).catch(E=>{throw console.error("Failed to load messages:",E),E})}function h(){let o=window.innerHeight-parseFloat(window.getComputedStyle(g).height)-50;t.style.height=o+"px"}async function i(){console.log("Sending message");const o=new pa;if(!await o.validateLogin()){ka("/signup");return}const E=_(c);console.log("user_id: ",o.apikey,"username:",o.username);const oe={username:o.username,message:E,user_id:o.apikey,chat_room:_(u)};d.send(JSON.stringify(oe)),z(c,"")}function s(){t.scrollTop=t.scrollHeight,console.log("Scrolled to bottom"),z(y,!1)}ga(()=>{t&&t.offsetHeight+t.scrollTop>t.scrollHeight-50&&ha().then(()=>{t.scrollTo(0,t.scrollHeight)})}),de(()=>{_(u),s()}),de(()=>{r().then(o=>{z(a,F(o)),console.log(o)}).catch(o=>{console.error("Error loading messages:",o)})}),wa(()=>{T(),setTimeout(()=>{s()},100),window.onresize=function(){h()},t.onload=s,t.onscroll=()=>{t.scrollTop+t.offsetHeight<t.scrollHeight-t.offsetHeight?z(y,!0):z(y,!1)}});var v=Ja(),x=K(v);Da(x,{get active(){return _(w)},set active(o){z(w,F(o))},get selectedChatroom(){return _(u)},set selectedChatroom(o){z(u,F(o))}});var p=b(x,2),n=f(p),k=f(n);k.__click=s;var N=b(k,2);{var A=o=>{var E=Ra();S(o,E)},C=o=>{var E=Pa(),oe=b(K(E),4);Je(oe,17,()=>_(a),$e,(Ge,se)=>{let Y=()=>_(se).username,pe=()=>_(se).message,Ue=()=>_(se).chat_room;var be=ye(),We=K(be);{var qe=le=>{var we=ye(),Ve=K(we);{var Ke=$=>{var H=Oa(),W=f(H),B=f(W),J=b(f(B),2);m(B);var q=b(B,2),ne=f(q,!0);m(q),m(W),m(H),G(()=>{Q(J,"alt",`${Y()??""}'s profile picture`),Q(J,"src",`/icons/${Y()??""}.png`),X(ne,pe())}),Z(5,H,()=>ze),Z(6,H,()=>Se),S($,H)},Xe=$=>{var H=Ba(),W=f(H),B=f(W),J=f(B),q=b(J,2),ne=f(q,!0);m(q),m(B);var ke=b(B,2),Qe=f(ke,!0);m(ke),m(W),m(H),G(()=>{Q(J,"alt",`${Y()??""}'s profile picture`),Q(J,"src",`/icons/${Y()??""}.png`),X(ne,Y()),X(Qe,pe())}),Z(5,H,()=>ze,()=>({axis:"x"})),Z(6,H,()=>Se),S($,H)};ce(Ve,$=>{Y()===ba("username")?$(Ke):$(Xe,!1)})}S(le,we)};ce(We,le=>{Ue()===_(u)&&le(qe)})}S(Ge,be)}),S(o,E)};ce(N,o=>{_(a).length===0?o(A):o(C,!1)})}m(n),ve(n,o=>t=o,()=>t);var M=b(n,2),D=f(M);D.__click=[Ie,w];var R=b(D,2),U=f(R);fe(U),U.__keydown=[Ya,i],ue(2),m(R);var ee=b(R,2);ee.__click=i,m(M),ve(M,o=>g=o,()=>g);var ae=b(M,2),_e=f(ae),ge=f(_e);ge.__click=[Ie,w];var he=b(ge,2),te=f(he),re=f(te);fe(re),re.__keydown=[$a,i],ue(2),m(te);var Fe=b(te,2);Fe.__click=i,m(he),m(_e),m(ae),ve(ae,o=>g=o,()=>g),m(p),G(()=>Ye(k,`scrollToBottom top fixed right round chip small-elevate tertiary-container ${(_(y)?"active":"")??""} svelte-1k9mdz7`)),me(U,()=>_(c),o=>z(c,o)),me(re,()=>_(c),o=>z(c,o)),S(l,v),Oe()}Be(["click","keydown"]);export{tt as component,at as universal};
