import{a as O,t as V,c as ke}from"../chunks/Ce9dqvW3.js";import{h as B,d as Te,b as Ee,E as S,aa as Se,ab as le,ac as ne,ad as G,x as U,ak as He,ar as P,u as ge,j as me,v as Ie,ao as he,_ as oe,g as Me,as as Ne,an as je,at as Ae,au as Ce,X as Re,a8 as De,a2 as Oe,m as Be,k as ie,av as ze,aw as Je,ax as Ye,ai as $e,p as Le,I as K,z as Ue,t as Q,a as Ve,K as A,c as y,s as I,f as ce,r as k,J as We,ay as qe}from"../chunks/Ch4HhSdZ.js";import{d as Fe,s as Z}from"../chunks/BmlV4D2q.js";import{p as ee,i as ue}from"../chunks/BS501eKZ.js";import{U as Pe,r as Xe,g as Ge,s as Ke,b as W,t as q,d as ve,c as fe}from"../chunks/dahw8YVr.js";import{b as Qe}from"../chunks/EBAiWnVy.js";import{b as F}from"../chunks/MfDRg49V.js";import{o as Ze}from"../chunks/Cd1vMRAD.js";import{g as ea}from"../chunks/D9QW22nr.js";function aa(i,e){return e}function sa(i,e,t,o){for(var r=[],v=e.length,c=0;c<v;c++)Ne(e[c].e,r,!0);var x=v>0&&r.length===0&&t!==null;if(x){var f=t.parentNode;je(f),f.append(t),o.clear(),M(i,e[0].prev,e[v-1].next)}Ae(r,()=>{for(var m=0;m<v;m++){var p=e[m];x||(o.delete(p.k),M(i,p.prev,p.next)),Ce(p.e,!x)}})}function ta(i,e,t,o,r,v=null){var c=i,x={flags:e,items:new Map,first:null};B&&Te();var f=null,m=!1,p=Re(()=>{var s=t();return De(s)?s:s==null?[]:he(s)});Ee(()=>{var s=S(p),d=s.length;if(m&&d===0)return;m=d===0;let l=!1;if(B){var n=c.data===Se;n!==(d===0)&&(c=le(),ne(c),G(!1),l=!0)}if(B){for(var h=null,b,_=0;_<d;_++){if(U.nodeType===8&&U.data===He){c=U,l=!0,G(!1);break}var u=s[_],w=o(u,_);b=_e(U,x,h,null,u,w,_,r,e),x.items.set(w,b),h=b}d>0&&ne(le())}if(!B){var z=Oe;ra(s,x,c,r,e,(z.f&P)!==0,o)}v!==null&&(d===0?f?ge(f):f=me(()=>v(c)):f!==null&&Ie(f,()=>{f=null})),l&&G(!0),S(p)}),B&&(c=U)}function ra(i,e,t,o,r,v,c,x){var f=i.length,m=e.items,p=e.first,s=p,d,l=null,n=[],h=[],b,_,u,w;for(w=0;w<f;w+=1){if(b=i[w],_=c(b,w),u=m.get(_),u===void 0){var z=s?s.e.nodes_start:t;l=_e(z,e,l,l===null?e.first:l.next,b,_,w,o,r),m.set(_,l),n=[],h=[],s=l.next;continue}if(la(u,b,w),u.e.f&P&&ge(u.e),u!==s){if(d!==void 0&&d.has(u)){if(n.length<h.length){var H=h[0],T;l=H.prev;var N=n[0],J=n[n.length-1];for(T=0;T<n.length;T+=1)de(n[T],H,t);for(T=0;T<h.length;T+=1)d.delete(h[T]);M(e,N.prev,J.next),M(e,l,N),M(e,J,H),s=H,l=J,w-=1,n=[],h=[]}else d.delete(u),de(u,s,t),M(e,u.prev,u.next),M(e,u,l===null?e.first:l.next),M(e,l,u),l=u;continue}for(n=[],h=[];s!==null&&s.k!==_;)(v||!(s.e.f&P))&&(d??(d=new Set)).add(s),h.push(s),s=s.next;if(s===null)continue;u=s}n.push(u),l=u,s=u.next}if(s!==null||d!==void 0){for(var a=d===void 0?[]:he(d);s!==null;)(v||!(s.e.f&P))&&a.push(s),s=s.next;var g=a.length;if(g>0){var Y=null;sa(e,a,Y,m)}}oe.first=e.first&&e.first.e,oe.last=l&&l.e}function la(i,e,t,o){Me(i.v,e),i.i=t}function _e(i,e,t,o,r,v,c,x,f,m){var p=(f&Je)!==0,s=(f&Ye)===0,d=p?s?Be(r):ie(r):r,l=f&ze?ie(c):c,n={i:l,v:d,k:v,a:null,e:null,prev:t,next:o};try{return n.e=me(()=>x(i,d,l),B),n.e.prev=t&&t.e,n.e.next=o&&o.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),o!==null&&(o.prev=n,o.e.prev=n.e),n}finally{}}function de(i,e,t){for(var o=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,v=i.e.nodes_start;v!==o;){var c=$e(v);r.before(v),v=c}}function M(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const wa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var na=V('<h3 class="center-align middle svelte-1us9j5x">No messages yet...</h3>'),oa=V('<article class="message bottom-round left-round border self svelte-1us9j5x"><div class="column" style="border-radius: 0"><div class="row self svelte-1us9j5x"><h5 class="right-align svelte-1us9j5x">You</h5> <img class="circle right right-align  large svelte-1us9j5x"></div> <p class="message-text"> </p></div></article>'),ia=V('<article class="message bottom-round right-round secondary-container svelte-1us9j5x"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text"> </p></div></article>'),ca=V(`<p id="top-line-text" class="center-align svelte-1us9j5x">You've reached the start of the chat</p> <p id="top-line" class="svelte-1us9j5x">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),ua=(i,e)=>{i.key==="Enter"&&e()},va=V('<main class="responsive fixed center middle svelte-1us9j5x"><div id="chatbox" class="bottom-padding svelte-1us9j5x"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav id="message-nav" class="center-align bottom-align svelte-1us9j5x" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="field label suffix border round fill large bottom fill" style="width:70%"><input type="text"> <label>Message</label></div> <button class="square round small-elevate extra primary right"><i>send</i></button></nav></main>');function ya(i,e){Le(e,!0);let t,o=K(ee([])),r,v,c=K(""),x,f,m=K(!1);function p(){f=new WebSocket(`wss://${window.location.host}/ws`),f.onopen=()=>{console.log("Connected to the WebSocket server")},f.onmessage=a=>{const g=JSON.parse(a.data);console.log("sSReceived message: ",g),A(o,ee([...S(o),g]))},f.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{p()},500)}}function s(){return fetch("/messages",{method:"GET"}).then(g=>{if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}).catch(g=>{throw console.error("Failed to load messages:",g),g})}function d(){let a=window.innerHeight-parseFloat(window.getComputedStyle(v).height)-50;r.style.height=a+"px"}async function l(){console.log("Sending message");const a=new Pe;if(!await a.validateLogin()){ea("/signup");return}const g=S(c);console.log("user_id: ",a.apikey,"username:",a.username);const Y={username:a.username,message:g,user_id:a.apikey};f.send(JSON.stringify(Y)),A(c,"")}function n(){r.scrollTop=r.scrollHeight,console.log("Scrolled to bottom"),A(m,!1)}Ue(()=>{S(o),r&&r.offsetHeight+r.scrollTop>r.scrollHeight-50&&qe().then(()=>{r.scrollTo(0,r.scrollHeight)})}),Ze(()=>{p(),setTimeout(()=>{n()},100),s().then(a=>{A(o,ee(a))}).catch(a=>{console.error("Error loading messages:",a)}),window.onresize=function(){d()},r.onload=n,r.onscroll=()=>{r.scrollTop+r.offsetHeight<r.scrollHeight-r.offsetHeight?A(m,!0):A(m,!1)}});var h=va(),b=y(h),_=y(b);_.__click=n;var u=I(_,2);{var w=a=>{var g=na();O(a,g)},z=a=>{var g=ca(),Y=I(ce(g),4);ta(Y,17,()=>S(o),aa,(pe,ae)=>{let C=()=>S(ae).username,se=()=>S(ae).message;var te=ke(),xe=ce(te);{var be=R=>{var E=oa(),$=y(E),j=y($),D=I(y(j),2);k(j);var L=I(j,2),X=y(L,!0);k(L),k($),k(E),Q(()=>{W(D,"alt",`${C()??""}'s profile picture`),W(D,"src",`/icons/${C()??""}.png`),Z(X,se())}),q(5,E,()=>ve),q(6,E,()=>fe),O(R,E)},we=R=>{var E=ia(),$=y(E),j=y($),D=y(j),L=I(D,2),X=y(L,!0);k(L),k(j);var re=I(j,2),ye=y(re,!0);k(re),k($),k(E),Q(()=>{W(D,"alt",`${C()??""}'s profile picture`),W(D,"src",`/icons/${C()??""}.png`),Z(X,C()),Z(ye,se())}),q(5,E,()=>ve,()=>({axis:"x"})),q(6,E,()=>fe),O(R,E)};ue(xe,R=>{C()===Ge("username")?R(be):R(we,!1)})}O(pe,te)}),O(a,g)};ue(u,a=>{S(o).length===0?a(w):a(z,!1)})}k(b),F(b,a=>r=a,()=>r);var H=I(b,2),T=y(H),N=y(T);Xe(N),N.__keydown=[ua,l],F(N,a=>x=a,()=>x),We(2),k(T);var J=I(T,2);J.__click=l,k(H),F(H,a=>v=a,()=>v),k(h),F(h,a=>t=a,()=>t),Q(()=>Ke(_,`scrollToBottom top fixed right round chip small-elevate tertiary-container ${(S(m)?"active":"")??""} svelte-1us9j5x`)),Qe(N,()=>S(c),a=>A(c,a)),O(i,h),Ve()}Fe(["click","keydown"]);export{ya as component,wa as universal};
