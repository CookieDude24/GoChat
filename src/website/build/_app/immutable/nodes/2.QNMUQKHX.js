import{a as B,t as W,c as we}from"../chunks/Ce9dqvW3.js";import{h as z,d as ke,b as Te,E,aa as Ee,ab as re,ac as le,ad as G,x as V,ak as Se,ar as P,u as de,j as ge,v as He,ao as me,_ as ne,g as Ie,as as Me,an as Ne,at as Ae,au as Ce,X as Re,a8 as De,a2 as Oe,m as Be,k as oe,av as ze,aw as Je,ax as Ye,ai as $e,p as Le,I as K,z as Ue,t as Q,a as Ve,K as C,c as w,s as I,f as ie,r as k,J as We,ay as qe}from"../chunks/Ch4HhSdZ.js";import{d as Fe,s as Z}from"../chunks/BmlV4D2q.js";import{p as j,i as ce}from"../chunks/BS501eKZ.js";import{U as Pe,r as Xe,g as Ge,s as Ke,b as q,t as fe,c as ve}from"../chunks/CXv6ZHf4.js";import{b as Qe}from"../chunks/B_k9T6Re.js";import{b as F}from"../chunks/MfDRg49V.js";import{o as Ze}from"../chunks/Cd1vMRAD.js";import{g as je}from"../chunks/zWxbn14Y.js";function ea(i,e){return e}function aa(i,e,t,o){for(var r=[],v=e.length,c=0;c<v;c++)Me(e[c].e,r,!0);var y=v>0&&r.length===0&&t!==null;if(y){var u=t.parentNode;Ne(u),u.append(t),o.clear(),M(i,e[0].prev,e[v-1].next)}Ae(r,()=>{for(var m=0;m<v;m++){var p=e[m];y||(o.delete(p.k),M(i,p.prev,p.next)),Ce(p.e,!y)}})}function sa(i,e,t,o,r,v=null){var c=i,y={flags:e,items:new Map,first:null};z&&ke();var u=null,m=!1,p=Re(()=>{var s=t();return De(s)?s:s==null?[]:me(s)});Te(()=>{var s=E(p),d=s.length;if(m&&d===0)return;m=d===0;let l=!1;if(z){var n=c.data===Ee;n!==(d===0)&&(c=re(),le(c),G(!1),l=!0)}if(z){for(var h=null,x,_=0;_<d;_++){if(V.nodeType===8&&V.data===Se){c=V,l=!0,G(!1);break}var f=s[_],b=o(f,_);x=he(V,y,h,null,f,b,_,r,e),y.items.set(b,x),h=x}d>0&&le(re())}if(!z){var J=Oe;ta(s,y,c,r,e,(J.f&P)!==0,o)}v!==null&&(d===0?u?de(u):u=ge(()=>v(c)):u!==null&&He(u,()=>{u=null})),l&&G(!0),E(p)}),z&&(c=V)}function ta(i,e,t,o,r,v,c,y){var u=i.length,m=e.items,p=e.first,s=p,d,l=null,n=[],h=[],x,_,f,b;for(b=0;b<u;b+=1){if(x=i[b],_=c(x,b),f=m.get(_),f===void 0){var J=s?s.e.nodes_start:t;l=he(J,e,l,l===null?e.first:l.next,x,_,b,o,r),m.set(_,l),n=[],h=[],s=l.next;continue}if(ra(f,x,b),f.e.f&P&&de(f.e),f!==s){if(d!==void 0&&d.has(f)){if(n.length<h.length){var H=h[0],T;l=H.prev;var N=n[0],Y=n[n.length-1];for(T=0;T<n.length;T+=1)ue(n[T],H,t);for(T=0;T<h.length;T+=1)d.delete(h[T]);M(e,N.prev,Y.next),M(e,l,N),M(e,Y,H),s=H,l=Y,b-=1,n=[],h=[]}else d.delete(f),ue(f,s,t),M(e,f.prev,f.next),M(e,f,l===null?e.first:l.next),M(e,l,f),l=f;continue}for(n=[],h=[];s!==null&&s.k!==_;)(v||!(s.e.f&P))&&(d??(d=new Set)).add(s),h.push(s),s=s.next;if(s===null)continue;f=s}n.push(f),l=f,s=f.next}if(s!==null||d!==void 0){for(var a=d===void 0?[]:me(d);s!==null;)(v||!(s.e.f&P))&&a.push(s),s=s.next;var g=a.length;if(g>0){var $=null;aa(e,a,$,m)}}ne.first=e.first&&e.first.e,ne.last=l&&l.e}function ra(i,e,t,o){Ie(i.v,e),i.i=t}function he(i,e,t,o,r,v,c,y,u,m){var p=(u&Je)!==0,s=(u&Ye)===0,d=p?s?Be(r):oe(r):r,l=u&ze?oe(c):c,n={i:l,v:d,k:v,a:null,e:null,prev:t,next:o};try{return n.e=ge(()=>y(i,d,l),z),n.e.prev=t&&t.e,n.e.next=o&&o.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),o!==null&&(o.prev=n,o.e.prev=n.e),n}finally{}}function ue(i,e,t){for(var o=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,v=i.e.nodes_start;v!==o;){var c=$e(v);r.before(v),v=c}}function M(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const xa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var la=W('<h3 class="center-align middle svelte-1xysgf5">No messages yet...</h3>'),na=W('<article class="message bottom-round left-round border self svelte-1xysgf5"><div class="column" style="border-radius: 0"><div class="row self svelte-1xysgf5"><h5 class="right-align svelte-1xysgf5">You</h5> <img class="circle right right-align  large svelte-1xysgf5"></div> <p class="message-text"> </p></div></article>'),oa=W('<article class="message bottom-round right-round secondary-container svelte-1xysgf5"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text"> </p></div></article>'),ia=W(`<p id="top-line-text" class="center-align svelte-1xysgf5">You've reached the start of the chat</p> <p id="top-line" class="svelte-1xysgf5">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),ca=(i,e)=>{i.key==="Enter"&&e()},fa=W('<main class="responsive fixed center middle svelte-1xysgf5"><div id="chatbox" class="bottom-padding svelte-1xysgf5"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav id="message-nav" class="center-align bottom-align svelte-1xysgf5" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="field label suffix border round fill large bottom fill" style="width:70%"><input type="text"> <label>Message</label></div> <button class="square round small-elevate extra primary right"><i>send</i></button></nav></main>');function ba(i,e){Le(e,!0);let t,o=K(j([])),r,v,c=K(""),y,u,m=K(!1);function p(){u=new WebSocket(`wss://${window.location.host}/ws`),u.onopen=()=>{console.log("Connected to the WebSocket server")},u.onmessage=a=>{const g=JSON.parse(a.data);console.log("sSReceived message: ",g),C(o,j([...E(o),g]))},u.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{p()},500)}}function s(){return fetch("/messages",{method:"GET"}).then(g=>{if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}).catch(g=>{throw console.error("Failed to load messages:",g),g})}function d(){let a=window.innerHeight-parseFloat(window.getComputedStyle(v).height)-50;r.style.height=a+"px"}async function l(){console.log("Sending message");const a=new Pe;if(!await a.validateLogin()){je("/signup");return}const g=E(c);console.log("user_id: ",a.apikey,"username:",a.username);const $={username:a.username,message:g,user_id:a.apikey};u.send(JSON.stringify($)),C(c,"")}function n(){r.scrollTop=r.scrollHeight,console.log("Scrolled to bottom"),C(m,!1)}Ue(()=>{E(o),r&&r.offsetHeight+r.scrollTop>r.scrollHeight-50&&qe().then(()=>{r.scrollTo(0,r.scrollHeight)})}),Ze(()=>{p(),setTimeout(()=>{n()},100),s().then(a=>{C(o,j(a))}).catch(a=>{console.error("Error loading messages:",a)}),window.onresize=function(){d()},r.onload=n,r.onscroll=()=>{r.scrollTop+r.offsetHeight<r.scrollHeight-r.offsetHeight?C(m,!0):C(m,!1)}});var h=fa(),x=w(h),_=w(x);_.__click=n;var f=I(_,2);{var b=a=>{var g=la();B(a,g)},J=a=>{var g=ia(),$=I(ie(g),4);sa($,17,()=>E(o),ea,(_e,ee)=>{let R=()=>E(ee).username,ae=()=>E(ee).message;var se=we(),pe=ie(se);{var ye=D=>{var S=na(),L=w(S),A=w(L),O=I(w(A),2);k(A);var U=I(A,2),X=w(U,!0);k(U),k(L),k(S),Q(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),Z(X,ae())}),fe(7,S,()=>ve),B(D,S)},xe=D=>{var S=oa(),L=w(S),A=w(L),O=w(A),U=I(O,2),X=w(U,!0);k(U),k(A);var te=I(A,2),be=w(te,!0);k(te),k(L),k(S),Q(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),Z(X,R()),Z(be,ae())}),fe(7,S,()=>ve,()=>({axis:"x"})),B(D,S)};ce(pe,D=>{R()===Ge("username")?D(ye):D(xe,!1)})}B(_e,se)}),B(a,g)};ce(f,a=>{E(o).length===0?a(b):a(J,!1)})}k(x),F(x,a=>r=a,()=>r);var H=I(x,2),T=w(H),N=w(T);Xe(N),N.__keydown=[ca,l],F(N,a=>y=a,()=>y),We(2),k(T);var Y=I(T,2);Y.__click=l,k(H),F(H,a=>v=a,()=>v),k(h),F(h,a=>t=a,()=>t),Q(()=>Ke(_,`scrollToBottom top fixed right round chip small-elevate tertiary-container ${(E(m)?"active":"")??""} svelte-1xysgf5`)),Qe(N,()=>E(c),a=>C(c,a)),B(i,h),Ve()}Fe(["click","keydown"]);export{ba as component,xa as universal};
