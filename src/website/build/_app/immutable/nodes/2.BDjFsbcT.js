import{a as B,t as W,c as ke}from"../chunks/Ce9dqvW3.js";import{h as z,d as Te,b as Ee,E as S,aa as Se,ab as oe,ac as le,ad as K,x as V,ak as He,ar as X,u as ge,j as he,v as Ie,ao as me,_ as ne,g as Me,as as Ne,an as Ae,at as Ce,au as Re,X as De,a8 as Oe,a2 as Be,m as ze,k as ie,av as Je,aw as Ye,ax as $e,ai as Le,p as Ue,I as Q,z as Ve,t as Z,a as We,K as C,c as x,s as I,f as ce,r as k,J as qe,ay as Fe}from"../chunks/Ch4HhSdZ.js";import{d as Pe,s as j}from"../chunks/BmlV4D2q.js";import{p as ee,i as ve}from"../chunks/BS501eKZ.js";import{U as Xe,r as Ge,g as Ke,s as Qe,b as q,t as F,d as ue,c as fe}from"../chunks/dahw8YVr.js";import{b as Ze}from"../chunks/EBAiWnVy.js";import{b as P}from"../chunks/MfDRg49V.js";import{o as je}from"../chunks/Cd1vMRAD.js";import{g as ea}from"../chunks/jslFWU-5.js";function aa(i,e){return e}function ta(i,e,s,n){for(var r=[],u=e.length,c=0;c<u;c++)Ne(e[c].e,r,!0);var b=u>0&&r.length===0&&s!==null;if(b){var f=s.parentNode;Ae(f),f.append(s),n.clear(),M(i,e[0].prev,e[u-1].next)}Ce(r,()=>{for(var h=0;h<u;h++){var p=e[h];b||(n.delete(p.k),M(i,p.prev,p.next)),Re(p.e,!b)}})}function sa(i,e,s,n,r,u=null){var c=i,b={flags:e,items:new Map,first:null};z&&Te();var f=null,h=!1,p=De(()=>{var t=s();return Oe(t)?t:t==null?[]:me(t)});Ee(()=>{var t=S(p),d=t.length;if(h&&d===0)return;h=d===0;let o=!1;if(z){var l=c.data===Se;l!==(d===0)&&(c=oe(),le(c),K(!1),o=!0)}if(z){for(var m=null,w,_=0;_<d;_++){if(V.nodeType===8&&V.data===He){c=V,o=!0,K(!1);break}var v=t[_],y=n(v,_);w=_e(V,b,m,null,v,y,_,r,e),b.items.set(y,w),m=w}d>0&&le(oe())}if(!z){var J=Be;ra(t,b,c,r,e,(J.f&X)!==0,n)}u!==null&&(d===0?f?ge(f):f=he(()=>u(c)):f!==null&&Ie(f,()=>{f=null})),o&&K(!0),S(p)}),z&&(c=V)}function ra(i,e,s,n,r,u,c,b){var f=i.length,h=e.items,p=e.first,t=p,d,o=null,l=[],m=[],w,_,v,y;for(y=0;y<f;y+=1){if(w=i[y],_=c(w,y),v=h.get(_),v===void 0){var J=t?t.e.nodes_start:s;o=_e(J,e,o,o===null?e.first:o.next,w,_,y,n,r),h.set(_,o),l=[],m=[],t=o.next;continue}if(oa(v,w,y),v.e.f&X&&ge(v.e),v!==t){if(d!==void 0&&d.has(v)){if(l.length<m.length){var H=m[0],T;o=H.prev;var N=l[0],Y=l[l.length-1];for(T=0;T<l.length;T+=1)de(l[T],H,s);for(T=0;T<m.length;T+=1)d.delete(m[T]);M(e,N.prev,Y.next),M(e,o,N),M(e,Y,H),t=H,o=Y,y-=1,l=[],m=[]}else d.delete(v),de(v,t,s),M(e,v.prev,v.next),M(e,v,o===null?e.first:o.next),M(e,o,v),o=v;continue}for(l=[],m=[];t!==null&&t.k!==_;)(u||!(t.e.f&X))&&(d??(d=new Set)).add(t),m.push(t),t=t.next;if(t===null)continue;v=t}l.push(v),o=v,t=v.next}if(t!==null||d!==void 0){for(var a=d===void 0?[]:me(d);t!==null;)(u||!(t.e.f&X))&&a.push(t),t=t.next;var g=a.length;if(g>0){var $=null;ta(e,a,$,h)}}ne.first=e.first&&e.first.e,ne.last=o&&o.e}function oa(i,e,s,n){Me(i.v,e),i.i=s}function _e(i,e,s,n,r,u,c,b,f,h){var p=(f&Ye)!==0,t=(f&$e)===0,d=p?t?ze(r):ie(r):r,o=f&Je?ie(c):c,l={i:o,v:d,k:u,a:null,e:null,prev:s,next:n};try{return l.e=he(()=>b(i,d,o),z),l.e.prev=s&&s.e,l.e.next=n&&n.e,s===null?e.first=l:(s.next=l,s.e.next=l.e),n!==null&&(n.prev=l,n.e.prev=l.e),l}finally{}}function de(i,e,s){for(var n=i.next?i.next.e.nodes_start:s,r=e?e.e.nodes_start:s,u=i.e.nodes_start;u!==n;){var c=Le(u);r.before(u),u=c}}function M(i,e,s){e===null?i.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}const ya=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var la=W('<h3 class="center-align middle svelte-1vc8h2o">No messages yet...</h3>'),na=W('<article class="message bottom-round left-round border self svelte-1vc8h2o"><div class="column" style="border-radius: 0"><div class="row self svelte-1vc8h2o"><h5 class="right-align svelte-1vc8h2o">You</h5> <img class="circle right right-align  large svelte-1vc8h2o"></div> <p class="message-text"> </p></div></article>'),ia=W('<article class="message bottom-round right-round secondary-container svelte-1vc8h2o"><div class="column" style="border-radius: 0"><div class="row"><img class="circle large"> <h5> </h5></div> <p class="message-text"> </p></div></article>'),ca=W(`<p id="top-line-text" class="center-align svelte-1vc8h2o">You've reached the start of the chat</p> <p id="top-line" class="svelte-1vc8h2o">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p> <!>`,1),va=(i,e)=>{i.key==="Enter"&&e()},ua=W('<main class="responsive fixed center middle svelte-1vc8h2o"><div id="chatbox" class="bottom-padding svelte-1vc8h2o"><button><span class="right-margin">Jump to newest messages</span> <i>arrow_downward</i></button> <!></div> <nav id="message-nav" class="center-align bottom-align svelte-1vc8h2o" style="padding-bottom: min(1vh,3vw); flex-grow: 1"><div class="field label suffix border round fill large bottom fill" style="width:70%"><input type="text"> <label>Message</label></div> <button class="square round small-elevate extra primary right"><i>send</i></button></nav></main>');function xa(i,e){Ue(e,!0);let s,n=Q(ee([])),r,u,c=Q(""),b,f,h=Q(!1);function p(){f=new WebSocket(`wss://${window.location.host}/ws`),f.onopen=()=>{console.log("Connected to the WebSocket server")},f.onmessage=a=>{const g=JSON.parse(a.data);console.log("sSReceived message: ",g),C(n,ee([...S(n),g]))},f.onclose=()=>{console.log("Disconnected from the WebSocket server ... trying to reconnect in 0.5 second"),setTimeout(()=>{p()},500)}}function t(){return fetch("/messages",{method:"GET"}).then(g=>{if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);return g.json()}).catch(g=>{throw console.error("Failed to load messages:",g),g})}function d(){let a=window.innerHeight-parseFloat(window.getComputedStyle(u).height)-50;r.style.height=a+"px"}async function o(){console.log("Sending message");const a=new Xe;if(!await a.validateLogin()){ea("/signup");return}const g=S(c);console.log("user_id: ",a.apikey,"username:",a.username);const $={username:a.username,message:g,user_id:a.apikey};f.send(JSON.stringify($)),C(c,"")}function l(){r.scrollTop=r.scrollHeight,console.log("Scrolled to bottom"),C(h,!1)}Ve(()=>{S(n),r&&r.offsetHeight+r.scrollTop>r.scrollHeight-50&&Fe().then(()=>{r.scrollTo(0,r.scrollHeight)})}),je(()=>{p(),setTimeout(()=>{l()},100),t().then(a=>{C(n,ee(a))}).catch(a=>{console.error("Error loading messages:",a)}),window.onresize=function(){d()},r.onload=l,r.onscroll=()=>{r.scrollTop+r.offsetHeight<r.scrollHeight-r.offsetHeight?C(h,!0):C(h,!1)}});var m=ua(),w=x(m),_=x(w);_.__click=l;var v=I(_,2);{var y=a=>{var g=la();B(a,g)},J=a=>{var g=ca(),$=I(ce(g),4);sa($,17,()=>S(n),aa,(pe,ae)=>{let R=()=>S(ae).username,te=()=>S(ae).message;var se=ke(),be=ce(se);{var we=D=>{var E=na(),L=x(E),A=x(L),O=I(x(A),2);k(A);var U=I(A,2),G=x(U,!0);k(U),k(L),k(E),Z(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),j(G,te())}),F(5,E,()=>ue),F(6,E,()=>fe),B(D,E)},ye=D=>{var E=ia(),L=x(E),A=x(L),O=x(A),U=I(O,2),G=x(U,!0);k(U),k(A);var re=I(A,2),xe=x(re,!0);k(re),k(L),k(E),Z(()=>{q(O,"alt",`${R()??""}'s profile picture`),q(O,"src",`/icons/${R()??""}.png`),j(G,R()),j(xe,te())}),F(5,E,()=>ue,()=>({axis:"x"})),F(6,E,()=>fe),B(D,E)};ve(be,D=>{R()===Ke("username")?D(we):D(ye,!1)})}B(pe,se)}),B(a,g)};ve(v,a=>{S(n).length===0?a(y):a(J,!1)})}k(w),P(w,a=>r=a,()=>r);var H=I(w,2),T=x(H),N=x(T);Ge(N),N.__keydown=[va,o],P(N,a=>b=a,()=>b),qe(2),k(T);var Y=I(T,2);Y.__click=o,k(H),P(H,a=>u=a,()=>u),k(m),P(m,a=>s=a,()=>s),Z(()=>Qe(_,`scrollToBottom top fixed right round chip small-elevate tertiary-container ${(S(h)?"active":"")??""} svelte-1vc8h2o`)),Ze(N,()=>S(c),a=>C(c,a)),B(i,m),We()}Pe(["click","keydown"]);export{xa as component,ya as universal};
